{% extends "./layout.html" %}

{% block title %}{{ page.title }} Â· {{ super() }}{% endblock %}

{% block description %}{{ page.description }}{% endblock %}

{% block head %}
    {{ super() }}
    {% if page.next and page.next.path %}
    <link rel="next" href="{{ page.next.path|resolveFile }}" />
    {% endif %}
    {% if page.previous and page.previous.path %}
    <link rel="prev" href="{{ page.previous.path|resolveFile }}" />
    {% endif %}
{% endblock %}

{% block javascript %}
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="{{ "gitbook.js"|resolveAsset }}"></script>
    <script src="{{ "theme.js"|resolveAsset }}"></script>
    {% for resource in plugins.resources.js %}
        {% if resource.url %}
        <script src="{{ resource.url }}"></script>
        {% else %}
        <script src="{{ resource.path|resolveAsset }}"></script>
        {% endif %}
    {% endfor %}
    <script>
        (function initDocsTableOverflow(){
            if (typeof document === "undefined") {
                return;
            }

            function ensureWrapper(table) {
                var parent = table.parentNode;
                if (!parent) {
                    return null;
                }
                if (parent.classList && parent.classList.contains("table-scroll-wrapper")) {
                    return parent;
                }
                var wrapper = document.createElement("div");
                wrapper.className = "table-scroll-wrapper";
                parent.insertBefore(wrapper, table);
                wrapper.appendChild(table);
                return wrapper;
            }

            function assignColumnIndexes(table) {
                var rows = table.querySelectorAll("tr");
                rows.forEach(function (row) {
                    Array.prototype.forEach.call(row.children, function (cell, index) {
                        cell.dataset.columnIndex = String(index);
                    });
                });
            }

            function getLockedColumnCount(table, totalColumns) {
                var explicit = table.dataset.lockColumns;
                var parsed = explicit ? parseInt(explicit, 10) : NaN;
                if (!Number.isNaN(parsed)) {
                    return Math.min(Math.max(parsed, 0), Math.max(totalColumns - 1, 0));
                }
                if (totalColumns >= 3) {
                    return 1;
                }
                return 0;
            }

            function toggleColumnVisibility(table, columnIndex, visible) {
                var selector = '[data-column-index="' + columnIndex + '"]';
                table.querySelectorAll(selector).forEach(function (cell) {
                    cell.style.display = visible ? "" : "none";
                });
            }

            function buildColumnControls(wrapper, table) {
                assignColumnIndexes(table);
                var headers = table.querySelectorAll("thead th");
                if (!headers.length || headers.length <= 1) {
                    return;
                }

                var controls = wrapper.previousElementSibling;
                if (!controls || !controls.classList.contains("table-column-controls")) {
                    controls = document.createElement("div");
                    controls.className = "table-column-controls";
                    controls.setAttribute("role", "group");
                    controls.setAttribute("aria-label", "Toggle columns");
                    wrapper.parentNode.insertBefore(controls, wrapper);
                } else {
                    controls.textContent = "";
                }

                var labelSpan = document.createElement("span");
                labelSpan.className = "table-column-controls__label";
                labelSpan.textContent = "Columns:";
                controls.appendChild(labelSpan);

                var lockCount = getLockedColumnCount(table, headers.length);
                for (var columnIndex = lockCount; columnIndex < headers.length; columnIndex += 1) {
                    (function bindToggle(idx) {
                        var label = document.createElement("label");
                        label.className = "table-column-toggle";
                        var checkbox = document.createElement("input");
                        checkbox.type = "checkbox";
                        var storedHidden = table.dataset["columnHidden_" + idx] === "true";
                        checkbox.checked = !storedHidden;
                        checkbox.dataset.columnIndex = String(idx);
                        checkbox.addEventListener("change", function (event) {
                            var target = event.target;
                            var columnId = target.dataset.columnIndex;
                            var visible = target.checked;
                            table.dataset["columnHidden_" + columnId] = visible ? "false" : "true";
                            toggleColumnVisibility(table, columnId, visible);
                        });
                        toggleColumnVisibility(table, idx, checkbox.checked);
                        var headerLabel = headers[idx].textContent || "";
                        var text = document.createElement("span");
                        var defaultLabel = "Column " + (idx + 1);
                        text.textContent = headerLabel.trim() || defaultLabel;
                        label.appendChild(checkbox);
                        label.appendChild(text);
                        controls.appendChild(label);
                    })(columnIndex);
                }
            }

            function enhanceTables() {
                var tables = document.querySelectorAll(".markdown-section table");
                tables.forEach(function (table) {
                    var wrapper = ensureWrapper(table);
                    if (!wrapper) {
                        return;
                    }
                    buildColumnControls(wrapper, table);
                });
            }

            function handleReady() {
                enhanceTables();
            }

            if (document.readyState === "loading") {
                document.addEventListener("DOMContentLoaded", handleReady, { once: true });
            } else {
                handleReady();
            }

            if (typeof gitbook !== "undefined" && gitbook.events && gitbook.events.on) {
                gitbook.events.on("page.change", enhanceTables);
            }
        })();
    </script>
{% endblock %}

{% block body %}
<div class="book honkit-cloak">
    <div class="book-summary">
        {% block book_sidebar %}
            {% block search_input %}{% endblock %}
            {% block book_summary %}
                <nav role="navigation">
                {% include "website/summary.html" %}
                </nav>
            {% endblock %}
        {% endblock %}
    </div>

    <div class="book-body">
        {% block book_body %}
            <div class="body-inner">
                {% block book_inner %}
                    {% include "website/header.html" %}

                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            {% block search_results %}
                                <section class="normal markdown-section">
                                {% block page %}
                                {{ page.content|safe }}
                                {% endblock %}
                                </section>
                            {% endblock %}
                        </div>
                    </div>
                {% endblock %}
            </div>

            {% block book_navigation %}
                {% if page.previous and page.previous.path %}
                <a href="{{ page.previous.path|resolveFile }}{{ page.previous.anchor }}" class="navigation navigation-prev {% if not (page.next and page.next.path) %}navigation-unique{% endif %}" aria-label="Previous page: {{ page.previous.title }}">
                    <i class="fa fa-angle-left"></i>
                </a>
                {% endif %}
                {% if page.next and page.next.path %}
                <a href="{{ page.next.path|resolveFile }}{{ page.next.anchor }}" class="navigation navigation-next {% if not (page.previous and page.previous.path) %}navigation-unique{% endif %}" aria-label="Next page: {{ page.next.title }}">
                    <i class="fa fa-angle-right"></i>
                </a>
                {% endif %}
            {% endblock %}
        {% endblock %}
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({{ template.getJSContext()|dump|safe }});
        });
    </script>
</div>
{% endblock %}
